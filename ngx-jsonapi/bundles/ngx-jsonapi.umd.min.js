!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("@angular/common/http"),require("util"),require("rxjs"),require("dexie"),require("rxjs/operators"),require("rxjs/internal/util/noop"),require("lodash")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common","@angular/common/http","util","rxjs","dexie","rxjs/operators","rxjs/internal/util/noop","lodash"],e):e(t["ngx-jsonapi"]={},t.ng.core,t.common,t.http,t.util,t.rxjs,t.Dexie,t.operators,t.noop,t.lodash)}(this,function(t,n,e,s,o,a,i,c,u,r){"use strict";i=i&&i.hasOwnProperty("default")?i.default:i;var d,l=(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}d(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),h=function(i,r){var n,o,s,t,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(i,a)}catch(t){e=[6,t],o=0}finally{n=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},p=function(){this.number=1,this.total_resources=0,this.size=0,this.resources_per_page=0},f=(v.propagateLoaded=function(t,e){for(var i in t){var r=t[i];r instanceof E&&r.setLoaded(e&&r.builded)}},v);function v(){}var g=(y.prototype.applyParams=function(t,e){if(void 0===e&&(e={}),this.appendPath(t.getPrePath()),e.beforepath&&this.appendPath(e.beforepath),this.appendPath(t.getPath()),e.include&&this.setInclude(e.include),function(t){return void 0!==t.id||void 0!==t.include_get||void 0!==t.include_save}(e)&&e.include_get&&this.setInclude(this.includes.concat(e.include_get)),e.fields&&0<Object.keys(e.fields).length)for(var i in e.fields){var r="fields["+i+"]="+e.fields[i].join(",");this.get_params.push(r)}},y.prototype.appendPath=function(t){""!==t&&this.paths.push(t)},y.prototype.getForCache=function(){return this.paths.join("/")+this.get_params.join("/")},y.prototype.get=function(){var t=this.get_params.slice();return 0<this.includes.length&&t.push("include="+this.includes.join(",")),this.paths.join("/")+(0<t.length?et.injectedServices.rsJsonapiConfig.params_separator+t.join("&"):"")},y.prototype.setInclude=function(t){this.includes=t},y);function y(){this.paths=[],this.includes=[],this.get_params=[]}var b=(m.json_array2resources_array_by_type=function(t){var e={},i={};for(var r in m.json_array2resources_array(t,e),e){var n=e[r];n.type in i||(i[n.type]={}),i[n.type][n.id]=n}return i},m.json2resource=function(t,e){if(m.getService(t.type))return m.procreate(t);n.isDevMode()&&console.warn("`"+t.type+"`","service not found on json2resource().","Use @Autoregister() on service and inject it on component.");var i=new R;return i.id=t.id,i.type=t.type,i},m.getService=function(t){return et.me.getResourceService(t)},m.getServiceOrFail=function(t){return et.me.getResourceServiceOrFail(t)},m.buildIncluded=function(t){return"included"in t&&t.included?m.json_array2resources_array_by_type(t.included):{}},m.procreate=function(t){"type"in t&&"id"in t||console.error("Jsonapi Resource is not correct",t);var e=I.getInstance().getOrCreateResource(t.type,t.id);return e.fill({data:t}),e.is_new=!1,e},m.json_array2resources_array=function(t,e){void 0===e&&(e={});for(var i=0,r=t;i<r.length;i++){var n=r[i],o=m.json2resource(n,!1);e[o.type+"_"+o.id]=o}},m);function m(){}var _=(w.prototype.buildRelationships=function(){for(var t in this.relationships_from){var e=this.relationships_from[t];this.relationships_dest[t]&&null===e.data&&(this.relationships_dest[t].data=null,this.relationships_dest[t].builded=!0,this.relationships_dest[t].is_loading=!1,this.relationships_dest[t].loaded=!0),e.data&&(this.relationships_dest[t]instanceof E?this.__buildRelationshipHasMany(e,t):this.relationships_dest[t]instanceof T&&this.__buildRelationshipHasOne(e,t))}},w.prototype.__buildRelationshipHasMany=function(t,e){if(0===t.data.length)return this.relationships_dest[e]=new E,void(this.relationships_dest[e].builded=!0);this.relationships_dest[e].fill(t)},w.prototype.__buildRelationshipHasOne=function(t,e){if("type"in t.data){if(this.relationships_dest[e].data||(this.relationships_dest[e].data=new R),t.data.id!==this.relationships_dest[e].data.id&&(this.relationships_dest[e].data=new R,this.relationships_dest[e].data.type=t.data.type),this.relationships_dest[e].data.id!==t.data.id||!this.relationships_dest[e].data.attributes||0===Object.keys(this.relationships_dest[e].data.attributes).length){var i=this.__buildRelationship(t.data);i?(this.relationships_dest[e].data=i,this.relationships_dest[e].builded=!0):(this.relationships_dest[e].data.id=t.data.id,this.relationships_dest[e].data.type=t.data.type)}}else this.relationships_dest[e].data=[]},w.prototype.__buildRelationship=function(t){if(t.type in this.included_resources&&t.id in this.included_resources[t.type]){var e=this.included_resources[t.type][t.id];return I.getInstance().setResource(e,!0),e}this.getService(t.type);var i=I.getInstance().getResource(t.type,t.id);if(i)return i},w);function w(t,e,i,r){this.getService=t,this.relationships_from=e,this.relationships_dest=i,this.included_resources=r}var R=(j.prototype.reset=function(){for(var t in this.id="",this.attributes={},this.is_new=!0,this.relationships)this.relationships[t]=this.relationships[t]instanceof E?new E:new T},j.prototype.toObject=function(t){var e,i={},r=[],n=[],o=(t=Object.assign({},A.ParamsResource,t)).include||[];for(var s in t.include_save&&(o=o.concat(t.include_save)),this.relationships){var a=this.relationships[s];if(a instanceof E){a.builded||a.data&&0!==a.data.length?i[s]={data:[]}:delete i[s];for(var c=0,u=a.data;c<u.length;c++){var d=u[c],l={id:d.id,type:d.type};i[s].data.push(l);var h=d.type+"_"+d.id;-1===n.indexOf(h)&&o&&-1!==o.indexOf(s)&&(n.push(h),r.push(d.toObject({}).data))}}else{if(null===a.data||void 0===a.data){i[s]={data:a.data};continue}a instanceof T||console.warn(a," is not DocumentCollection or DocumentResource");var p=a.data;if(a.data&&!("id"in a.data)&&0<Object.keys(a.data).length&&console.warn(s+" defined with hasMany:false, but I have a collection"),p.id&&p.type)i[s]={data:{id:p.id,type:p.type}};else if(!a.builded&&!p.id&&!p.type){delete i[s];continue}h=p.type+"_"+p.id,-1===n.indexOf(h)&&o&&-1!==o.indexOf(s)&&(n.push(h),r.push(p.toObject({}).data))}}this.getService()&&this.getService().parseToServer?(e=Object.assign({},this.attributes),this.getService().parseToServer(e)):e=this.attributes;var f={data:{type:this.type,id:this.id,attributes:e,relationships:i}};return this.meta&&(f.data.meta=this.meta),t.meta&&(f.meta=t.meta),0<r.length&&(f.included=r),f},j.prototype.fill=function(t){this.id=t.data.id||"",this.attributes=Object.assign({},this.attributes||{},t.data.attributes),this.data_resource=t,this.is_new=!1;var e=b.getService(t.data.type);if(!this.relationships&&e&&(this.relationships=(new e.resource).relationships),!e)return!1;if(Object.keys(this.attributes).length){var i=b.getService(this.type);i&&"parseFromServer"in i&&i.parseFromServer(this.attributes)}return"cache_last_update"in t.data&&(this.cache_last_update=t.data.cache_last_update),new _(b.getService,t.data.relationships||{},this.relationships,b.buildIncluded(t)).buildRelationships(),!0},j.prototype.addRelationship=function(t,e){var i=this.relationships[e||t.type];i instanceof E?i.replaceOrAdd(t):i.data=t},j.prototype.addRelationships=function(t,e){var i=this;if(0!==t.length){if(!(this.relationships[e]instanceof E))throw new Error("addRelationships require a DocumentCollection (hasMany) relation.");t.forEach(function(t){i.addRelationship(t,e)})}},j.prototype.removeRelationship=function(t,e){if(!(t in this.relationships))return!1;if(!("data"in this.relationships[t]))return!1;var i=this.relationships[t];return i instanceof E?(i.data=i.data.filter(function(t){return t.id!==e}),0===i.data.length&&(i.builded=!0)):i.data=null,!0},j.prototype.hasManyRelated=function(t){return this.relationships[t]&&0<this.relationships[t].data.length},j.prototype.hasOneRelated=function(t){return Boolean(this.relationships[t]&&this.relationships[t].data.type&&""!==this.relationships[t].data.type)},j.prototype.restore=function(t){return void 0===t&&(t={}),t.meta=Object.assign({},t.meta,{restore:!0}),this.save(t)},j.prototype.getService=function(){return b.getServiceOrFail(this.type)},j.prototype.delete=function(){return this.getService().delete(this.id)},j.prototype.save=function(t){var e=this;if(t=Object.assign({},A.ParamsResource,t),this.is_saving||!this.loaded)return a.of({});this.is_saving=!0;var i=new a.Subject,r=this.toObject(t);""===this.id&&delete r.data.id;var n=new g;return n.applyParams(this.getService(),t),this.id&&n.appendPath(this.id),et.exec(n.get(),this.is_new?"POST":"PATCH",r,!0).subscribe(function(t){e.is_saving=!1,e.id||(I.getInstance().deprecateCollections(n.get()),(new B).deprecateCollection(n.get())),"id"in t.data?(e.id=t.data.id,e.fill(t)):o.isArray(t.data)&&console.warn("Server return a collection when we save()",t.data),i.next(t),i.complete()},function(t){e.is_saving=!1,i.error("data"in t?t.data:t)}),i.asObservable()},j.prototype.setLoaded=function(t){this.is_loading=!t,this.loaded=t},j.prototype.setLoadedAndPropagate=function(t){this.setLoaded(t),f.propagateLoaded(this.relationships,t)},j.prototype.setSource=function(t){this.source=t},j.prototype.setSourceAndPropagate=function(t){for(var e in this.setSource(t),this.relationships){var i=this.relationships[e];i instanceof E&&i.setSource(t)}},j.prototype.setCacheLastUpdate=function(t){void 0===t&&(t=Date.now()),this.cache_last_update=t},j);function j(){this.id="",this.type="",this.attributes={},this.relationships={},this.links={},this.is_new=!0,this.is_saving=!1,this.is_loading=!1,this.loaded=!0,this.source="new",this.cache_last_update=0,this.ttl=0}function S(){this.builded=!1,this.is_loading=!0,this.loaded=!1,this.source="new",this.cache_last_update=0,this.meta={}}var O,C=(l(P,O=S),P.prototype.trackBy=function(t){return t.id},P.prototype.find=function(t){if("ids"===this.content)return null;for(var e=0;e<this.data.length;e++)if(this.data[e].id===t)return this.data[e];return null},P.prototype.fill=function(t){this.data_collection=t,b.buildIncluded(t),this.page&&t.meta&&(this.page.number=t.meta.page||1,this.page.resources_per_page=t.meta.resources_per_page||null,this.page.size=t.meta.resources_per_page||null,this.page.total_resources=t.meta.total_resources||null);var e={};this.data.length=0,this.builded=t.data&&0===t.data.length;for(var i=0,r=t.data;i<r.length;i++){var n=r[i];try{var o=this.getResourceOrFail(n);o.fill({data:n}),e[n.id]=n.id,this.data.push(o),0<Object.keys(o.attributes).length&&(this.builded=!0)}catch(t){this.content="ids",this.builded=!1,this.data.push({id:n.id,type:n.type})}}for(var s=void 0;s<this.data.length;s++)this.data[s].id in e||delete this.data[s];this.meta=t.meta||{},"cache_last_update"in t&&(this.cache_last_update=t.cache_last_update)},P.prototype.getResourceOrFail=function(t){var e=this.find(t.id);if(null!==e)return e;var i=b.getService(t.type);if(!i)throw n.isDevMode()&&console.warn("The relationship relation_alias? (type "+t.type+") cant be generated because service for this type has not been injected."),new Error("Cant create service for "+t.type);return i.getOrCreateResource(t.id)},P.prototype.replaceOrAdd=function(t){var e=this.find(t.id);null===e?this.data.push(t):e=t},P.prototype.hasMorePages=function(){return!this.page.size||this.page.size<1?null:this.page.size*(this.page.number-1)+this.data.length<this.page.total_resources},P.prototype.setLoaded=function(t){this.is_loading=!t,this.loaded=t},P.prototype.setLoadedAndPropagate=function(e){this.setLoaded(e),"ids"!==this.content&&this.data.forEach(function(t){f.propagateLoaded(t.relationships,e)})},P.prototype.setBuilded=function(t){this.builded=t},P.prototype.setBuildedAndPropagate=function(e){this.setBuilded(e),"ids"!==this.content&&this.data.forEach(function(t){t.setLoaded(e)})},P.prototype.setSource=function(t){this.source=t},P.prototype.setSourceAndPropagate=function(e){this.setSource(e),this.data.forEach(function(t){t instanceof R&&t.setSource(e)})},P.prototype.setCacheLastUpdate=function(t){void 0===t&&(t=Date.now()),this.cache_last_update=t},P.prototype.setCacheLastUpdateAndPropagate=function(e){void 0===e&&(e=Date.now()),this.setCacheLastUpdate(e),this.data.forEach(function(t){t instanceof R&&t.setCacheLastUpdate(e)})},P.prototype.toObject=function(e){return this.builded?{data:this.data.map(function(t){return t.toObject(e).data})}:{data:this.data}},P);function P(){var t=O.apply(this,arguments)||this;return t.data=[],t.page=new p,t.ttl=0,t.content="ids",t}var D,E=(l(x,D=C),x);function x(){var t=D.apply(this,arguments)||this;return t.data=[],t.content="collection",t}var A=(F.newCollection=function(){return new E},F.isObjectLive=function(t,e){return 0<=t&&Date.now()<=e+1e3*t},F.forEach=function(e,i){Object.keys(e).forEach(function(t){i(e[t],t)})},F);function F(){}A.ParamsResource={beforepath:"",ttl:void 0,include:[],fields:{},id:""},A.ParamsCollection={beforepath:"",ttl:void 0,include:[],remotefilter:{},fields:{},smartfilter:{},sort:[],page:new p,store_cache_method:"individual",storage_ttl:0,cachehash:""};var I=(k.getInstance=function(){return k.instance||(k.instance=new k),k.instance},k.prototype.clearCache=function(){this.resources={},this.collections={},k.instance=null},k.prototype.getResource=function(t,e){return this.getKey(t,e)in this.resources?this.resources[this.getKey(t,e)]:null},k.prototype.getResourceOrFail=function(t,e){if(this.getKey(t,e)in this.resources)return this.resources[this.getKey(t,e)];throw new Error("The requested resource does not exist in cache memory")},k.prototype.getKey=function(t,e){return t+"."+e},k.prototype.getOrCreateCollection=function(t){return t in this.collections||(this.collections[t]=new E,this.collections[t].source="new"),this.collections[t]},k.prototype.setCollection=function(t,e){t in this.collections||(this.collections[t]=new E);for(var i=0;i<e.data.length;i++){var r=e.data[i];this.setResource(r,!0)}this.collections[t].data=e.data,this.collections[t].page=e.page,this.collections[t].cache_last_update=e.cache_last_update},k.prototype.getOrCreateResource=function(t,e){var i=this.getResource(t,e);return null!==i||((i=b.getServiceOrFail(t).new()).id=e,this.setResource(i,!1)),i},k.prototype.setResource=function(t,e){void 0===e&&(e=!1),this.getKey(t.type,t.id)in this.resources?this.fillExistentResource(t):this.resources[this.getKey(t.type,t.id)]=t,this.resources[this.getKey(t.type,t.id)].cache_last_update=e?Date.now():0},k.prototype.deprecateCollections=function(t){for(var e in void 0===t&&(t=""),this.collections)e.includes(t)&&(this.collections[e].cache_last_update=0);return!0},k.prototype.removeResource=function(i,r){var t=this.getResource(i,r);if(t){for(var e in A.forEach(this.collections,function(t,e){t.data.splice(t.data.findIndex(function(t){return t.type===i&&t.id===r}),1)}),t.attributes={},t.relationships)null!==t.relationships[e].data&&void 0!==t.relationships[e].data&&(t.relationships[e].data instanceof Array?t.relationships[e].data=[]:t.relationships[e].data instanceof Object&&delete t.relationships[e].data);delete this.resources[this.getKey(i,r)]}},k.prototype.fillExistentResource=function(t){var e=this.getResourceOrFail(t.type,t.id);e.attributes=Object.assign({},e.attributes,t.attributes),e.relationships=e.relationships||t.relationships},k);function k(){this.resources={},this.collections={}}var L,T=(l(J,L=S),J.prototype.fill=function(t){this.builded=!1,this.content="id",null!==(this.data_resource=t)?(this.data||(this.data=I.getInstance().getOrCreateResource(t.data.type,t.data.id)),this.data.fill(t)&&(this.builded=!0,this.content="resource"),this.meta=t.meta||{}):this.data=null},J.prototype.unsetData=function(){this.data=void 0,this.builded=!1},J);function J(){var t=L.apply(this,arguments)||this;return t.data=new R,t.builded=!1,t.content="id",t}var q=function(o,s,a,c){return new(a||(a=Promise))(function(t,e){function i(t){try{n(c.next(t))}catch(t){e(t)}}function r(t){try{n(c.throw(t))}catch(t){e(t)}}function n(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(i,r)}n((c=c.apply(o,s||[])).next())})},M=(K.prototype.getElement=function(i,r){return void 0===r&&(r="elements"),q(this,void 0,void 0,function(){var e;return h(this,function(t){switch(t.label){case 0:return[4,K.db.open()];case 1:return t.sent(),[4,K.db.table(r).get(i)];case 2:if(void 0===(e=t.sent()))throw new Error(i+" not found.");return[2,e]}})})},K.prototype.getElements=function(i,r){return void 0===r&&(r="elements"),q(this,void 0,void 0,function(){var e;return h(this,function(t){switch(t.label){case 0:return e={},[4,K.db.table(r).where(":id").anyOf(i).each(function(t){e[t.data.type+"."+t.data.id]=t})];case 1:return t.sent(),[2,i.map(function(t){return e[t]})]}})})},K.prototype.updateElements=function(i,t,r){return void 0===r&&(r="elements"),q(this,void 0,void 0,function(){var e=this;return h(this,function(t){return[2,K.db.open().then(function(){return q(e,void 0,void 0,function(){return h(this,function(t){return""===i?[2,K.db.table(r).clear()]:[2,K.db.table(r).where(":id").startsWith(i).delete().then(function(){})]})})})]})})},K.prototype.saveElements=function(r,n){return void 0===n&&(n="elements"),q(this,void 0,void 0,function(){var e,i;return h(this,function(t){return e=[],i=r.map(function(t){return e.push(t.key),t.content}),[2,K.db.open().then(function(){K.db.table(n).bulkPut(i,e)})]})})},K);function K(){K.db||(K.db=new i("dexie_data_provider")).version(1).stores({collections:"",elements:""})}var H=function(o,s,a,c){return new(a||(a=Promise))(function(t,e){function i(t){try{n(c.next(t))}catch(t){e(t)}}function r(t){try{n(c.throw(t))}catch(t){e(t)}}function n(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(i,r)}n((c=c.apply(o,s||[])).next())})};var B=(W.prototype.getResource=function(n,o){return void 0===o&&(o=[]),H(this,void 0,void 0,function(){var i,r,e;return h(this,function(t){switch(t.label){case 0:return[4,this.getDataResources([n])];case 1:if(void 0===(i=t.sent().shift()))throw new Error("Resource "+n+" don't found.");return 0===o.length?[2,i]:(r=[],o.forEach(function(t){if(!i||!i.data.relationships||!i.data.relationships[t])throw new Error("We dont have relation_alias on stored data resource");var e=i.data.relationships[t].data;e instanceof Array?e.forEach(function(t){r.push(W.getResourceKey(t))}):e&&"id"in e&&r.push(W.getResourceKey(e))}),[4,this.getDataResources(r)]);case 2:return e=t.sent(),[2,Object.assign({},i,{included:e.map(function(t){return t.data})})]}})})},W.prototype.getCollection=function(s,a){return void 0===a&&(a=[]),H(this,void 0,void 0,function(){var e,r,i,n,o;return h(this,function(t){switch(t.label){case 0:return[4,this.getDataCollection(s)];case 1:return e=t.sent(),[4,this.getDataResources(e.keys)];case 2:return r=t.sent(),i={data:r.map(function(t){return t.data}),cache_last_update:e.updated_at},0===a.length?[2,i]:(n=[],a.forEach(function(i){r.forEach(function(t){if(t.data.relationships&&t.data.relationships[i]){var e=t.data.relationships[i].data;e instanceof Array?e.forEach(function(t){n.push(W.getResourceKey(t))}):"id"in e&&n.push(W.getResourceKey(e))}})}),[4,this.getDataResources(n)]);case 3:return o=t.sent(),[2,Object.assign({},i,{included:o.map(function(t){return t.data})})]}})})},W.prototype.getDataCollection=function(e){return H(this,void 0,void 0,function(){return h(this,function(t){return[2,this.dataProvider.getElement(e,"collections")]})})},W.prototype.getDataResources=function(e){return H(this,void 0,void 0,function(){return h(this,function(t){return[2,this.dataProvider.getElements(e,"elements")]})})},W.prototype.saveCollection=function(t,e,i){void 0===i&&(i=[]),this.dataProvider.saveElements(W.collectionToElement(t,e),"collections"),this.dataProvider.saveElements(W.collectionResourcesToElements(e,i),"elements")},W.prototype.saveResource=function(e,i){return void 0===i&&(i=[]),H(this,void 0,void 0,function(){return h(this,function(t){return[2,this.dataProvider.saveElements(W.toResourceElements(W.getResourceKey(e),e,i),"elements")]})})},W.collectionToElement=function(t,e){var i={key:t,content:{updated_at:Date.now(),keys:[]}};return e.data.forEach(function(t){var e=W.getResourceKey(t);i.content.keys.push(e)}),[i]},W.collectionResourcesToElements=function(t,i){void 0===i&&(i=[]);var r=[];return t.data.forEach(function(t){var e=W.getResourceKey(t);r.push.apply(r,W.toResourceElements(e,t,i))}),r},W.toResourceElements=function(t,i,e){void 0===e&&(e=[]);var r=[{key:t,content:i.toObject()}];return r[0].content.data.cache_last_update=Date.now(),e.forEach(function(t){var e=i.relationships[t];if(e instanceof E)e.data.forEach(function(t){r.push(W.getElement(t))});else if(e instanceof T){if(null===e.data||void 0===e.data)return;r.push(W.getElement(e.data))}}),r},W.getResourceKey=function(t){return t.type+"."+t.id},W.getElement=function(t){return{key:W.getResourceKey(t),content:t.toObject()}},W.prototype.deprecateCollection=function(e){return H(this,void 0,void 0,function(){return h(this,function(t){return[2,this.dataProvider.updateElements(e,{},"collections")]})})},W);function W(){this.dataProvider=new M}function z(t,e){var i=e&&"number"==typeof e?e:t.ttl||0;return Date.now()<t.cache_last_update+1e3*i}function G(t,e,i){var r=i.value;return i.value=function(){var t,e=Array.prototype.slice.call(arguments);try{t="string"==typeof e[0]?e[0]:e[0].type}catch(t){return console.warn("ERROR: First argument of methods decorated with serviceIsRegistered has to be string or Resource."),null}return et.me.getResourceService(t)?r.apply(this,e):(console.warn("ERROR: "+t+" service has not been registered."),null)},i}var U=function(){this.url="http://yourdomain/api/v1/",this.params_separator="?",this.unify_concurrency=!0,this.cache_prerequests=!0,this.cachestore_support=!0,this.parameters={page:{number:"page[number]",size:"page[size]"}}},N=(V.prototype.exec=function(t,e,i){var r=this,n={body:i||null,headers:new s.HttpHeaders({"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"})};if("get"!==e)return this.http.request(e,this.rsJsonapiConfig.url+t,n).pipe(c.tap(function(){delete r.get_requests[t]}),c.share());if(this.get_requests[t])return this.get_requests[t];var o=this.http.request(e,this.rsJsonapiConfig.url+t,n).pipe(c.tap(function(){delete r.get_requests[t]}),c.share());return this.get_requests[t]=o},V);function V(t,e){this.http=t,this.rsJsonapiConfig=e,this.get_requests={}}N.decorators=[{type:n.Injectable}],N.ctorParameters=function(){return[{type:s.HttpClient},{type:U}]};var Q=function(o,s,a,c){return new(a||(a=Promise))(function(t,e){function i(t){try{n(c.next(t))}catch(t){e(t)}}function r(t){try{n(c.throw(t))}catch(t){e(t)}}function n(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(i,r)}n((c=c.apply(o,s||[])).next())})};var X=(Y.prototype.getDataObject=function(r,n){return Q(this,void 0,void 0,function(){var e,i;return h(this,function(t){switch(t.label){case 0:return e="collection"===r?"collections":"elements",[4,this.db.open()];case 1:return t.sent(),[4,this.db.table(e).get(r+"."+n)];case 2:if(void 0===(i=t.sent()))throw new Error;return[2,i]}})})},Y.prototype.getDataResources=function(r){return Q(this,void 0,void 0,function(){var e,i;return h(this,function(t){switch(t.label){case 0:return e=this.db.table("elements").where(":id").anyOf(r),i={},[4,e.each(function(t){i[t.id]=t})];case 1:return t.sent(),[2,i]}})})},Y.prototype.saveResource=function(e,i,t){var r=this,n=Object.assign({cache_last_update:Date.now()},t);this.db.open().then(function(){return Q(r,void 0,void 0,function(){return h(this,function(t){return[2,this.db.table("elements").put(n,e+"."+i)]})})})},Y.prototype.saveCollection=function(e,t){var i=this,r=Object.assign({cache_last_update:Date.now()},t);this.db.open().then(function(){return Q(i,void 0,void 0,function(){return h(this,function(t){return[2,this.db.table("collections").put(r,"collection."+e)]})})})},Y.prototype.clearCache=function(){var t=this;this.db.open().then(function(){return Q(t,void 0,void 0,function(){return h(this,function(t){return[2,this.db.table("elements").toCollection().delete()]})})}),this.db.open().then(function(){return Q(t,void 0,void 0,function(){return h(this,function(t){return[2,this.db.table("collections").toCollection().delete()]})})})},Y.prototype.deprecateResource=function(e,i){var t=this;this.db.open().then(function(){return Q(t,void 0,void 0,function(){return h(this,function(t){return[2,this.db.table("elements").where(":id").startsWith(e+"."+i).modify({cache_last_update:0})]})})})},Y.prototype.deprecateCollection=function(e){var t=this;this.db.open().then(function(){return Q(t,void 0,void 0,function(){return h(this,function(t){return[2,this.db.table("collections").where(":id").startsWith(e).modify({cache_last_update:0})]})})})},Y.prototype.removeObjectsWithKey=function(t){return Q(this,void 0,void 0,function(){return h(this,function(t){return[2]})})},Y.prototype.checkIfIsTimeToClean=function(){},Y.prototype.checkAndDeleteOldElements=function(){},Y);function Y(){this.db=new i("jsonapi_db"),this.db.version(1).stores({collections:"",elements:""}),this.checkIfIsTimeToClean()}var Z=function(t,e,i,r){var n,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;0<=a;a--)(n=t[a])&&(s=(o<3?n(s):3<o?n(e,i,s):n(e,i))||s);return 3<o&&s&&Object.defineProperty(e,i,s),s},$=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},tt=function(o,s,a,c){return new(a||(a=Promise))(function(t,e){function i(t){try{n(c.next(t))}catch(t){e(t)}}function r(t){try{n(c.throw(t))}catch(t){e(t)}}function n(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(i,r)}n((c=c.apply(o,s||[])).next())})},et=(it.delete=function(t){return it.exec(t,"DELETE")},it.get=function(t){return it.exec(t,"get")},it.exec=function(t,e,i,r){return void 0===r&&(r=!0),it.me.refreshLoadings(1),it.injectedServices.JsonapiHttp.exec(t,e,i).pipe(c.tap(function(){return it.me.refreshLoadings(-1)}),c.catchError(function(t){return t=t.error||t,it.me.refreshLoadings(-1),t.status<=0?!it.me.loadingsOffline(t)&&n.isDevMode()&&console.warn("Jsonapi.Http.exec (use JsonapiCore.loadingsOffline for catch it) error =>",t):r&&!it.me.loadingsError(t)&&n.isDevMode()&&console.warn("Jsonapi.Http.exec (use JsonapiCore.loadingsError for catch it) error =>",t),a.throwError(t)}))},it.prototype.registerService=function(t){return!(t.type in this.resourceServices)&&(this.resourceServices[t.type]=t)},it.prototype.getResourceService=function(t){return this.resourceServices[t]},it.prototype.getResourceServiceOrFail=function(t){var e=this.resourceServices[t];if(!e)throw new Error("The requested service with type "+t+" has not been registered, please use register() method or @Autoregister() decorator");return e},it.removeCachedResource=function(t,e){I.getInstance().removeResource(t,e)},it.setCachedResource=function(t){I.getInstance().setResource(t,!0)},it.deprecateCachedCollections=function(t){var e=it.me.getResourceServiceOrFail(t),i=new g;i.applyParams(e),I.getInstance().deprecateCollections(i.getForCache())},it.prototype.refreshLoadings=function(t){this.loadingsCounter+=t,0===this.loadingsCounter?this.loadingsDone():1===this.loadingsCounter&&this.loadingsStart()},it.prototype.clearCache=function(){return tt(this,void 0,void 0,function(){return h(this,function(t){return it.injectedServices.JsonapiStoreService.clearCache(),I.getInstance().clearCache(),[2,(new B).deprecateCollection("").then(function(){return!0})]})})},it.prototype.duplicateResource=function(i){for(var r=this,n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];var o=this.getResourceServiceOrFail(i.type).new();function e(e){var t=i.relationships[e];if(!t.data)return o.relationships[e]=i.relationships[e],"continue";"id"in t.data?-1<n.indexOf(e)?o.addRelationship(s.duplicateResource(t.data),e):o.addRelationship(t.data,e):-1<n.indexOf(e)?t.data.forEach(function(t){o.addRelationship(r.duplicateResource(t),e)}):o.addRelationships(t.data,e)}o.id="new_"+Math.floor(1e4*Math.random()).toString(),o.attributes=Object.assign({},o.attributes,i.attributes);var s=this;for(var a in i.relationships)e(a);return o},it);function it(t,e,i){for(var r in this.loadingsCounter=0,this.loadingsStart=u.noop,this.loadingsDone=u.noop,this.loadingsError=u.noop,this.loadingsOffline=u.noop,this.resourceServices={},this.config=new U,this.config)this.config[r]=void 0!==t[r]?t[r]:this.config[r];it.me=this,it.injectedServices={JsonapiStoreService:e,JsonapiHttp:i,rsJsonapiConfig:this.config}}et.decorators=[{type:n.Injectable}],et.ctorParameters=function(){return[{type:U,decorators:[{type:n.Optional}]},{type:X},{type:N}]},Z([G,$("design:type",Function),$("design:paramtypes",[String,String]),$("design:returntype",void 0)],et,"removeCachedResource",null),Z([G,$("design:type",Function),$("design:paramtypes",[R]),$("design:returntype",void 0)],et,"setCachedResource",null),Z([G,$("design:type",Function),$("design:paramtypes",[String]),$("design:returntype",void 0)],et,"deprecateCachedCollections",null);var rt=(nt.forRoot=function(t){return{ngModule:nt,providers:[{provide:U,useValue:t}]}},nt);function nt(t,e){if(t)throw new Error("NgxJsonapiModule is already loaded. Import it in the AppModule only")}rt.decorators=[{type:n.NgModule,args:[{imports:[e.CommonModule],exports:[s.HttpClientModule],providers:[et,X,U,N]}]}],rt.ctorParameters=function(){return[{type:rt,decorators:[{type:n.Optional},{type:n.SkipSelf}]},{type:et}]};var ot=(st.prototype.toparams=function(t){var i=this,r="";return A.forEach(t,function(t,e){r+=i.toparamsarray(t,"&"+e)}),r.slice(1)},st.prototype.toparamsarray=function(t,i){var r=this,n="";return Array.isArray(t)?A.forEach(t,function(t,e){n+=i+"[]="+t}):o.isObject(t)?A.forEach(t,function(t,e){n+=r.toparamsarray(t,i+"["+e+"]")}):n+=i+"="+t,n},st);function st(){}var at,ct=(l(ut,at=g),ut.prototype.applyParams=function(t,e){void 0===e&&(e={}),at.prototype.applyParams.call(this,t,e);var i=new ot;e.remotefilter&&0<Object.keys(e.remotefilter).length&&(t.parseToServer&&t.parseToServer(e.remotefilter),this.addParam(i.toparams({filter:e.remotefilter}))),e.page&&(1<e.page.number&&this.addParam(this.getPageConfig().number+"="+e.page.number),e.page.size&&this.addParam(this.getPageConfig().size+"="+e.page.size)),e.sort&&e.sort.length&&this.addParam("sort="+e.sort.join(","))},ut.prototype.getPageConfig=function(){return et.injectedServices.rsJsonapiConfig.parameters&&et.injectedServices.rsJsonapiConfig.parameters.page||{number:"number",size:"size"}},ut.prototype.addParam=function(t){this.get_params.push(t)},ut);function ut(){return null!==at&&at.apply(this,arguments)||this}var dt=(lt.prototype.getResourceObject=function(){return this.resource_object},lt.prototype.removeDuplicatedIncludes=function(){if(!this.resource_object.included||!this.parent_resource_object.included)return this;var t=this.parent_resource_object.included;return this.resource_object.included=this.resource_object.included.filter(function(e){return!r.isEqual(e,t.find(function(t){return t.id===e.id}))}),this.resource_object.included=this.resource_object.included.map(function(e){return t.find(function(t){return t.id===e.id})?new lt(e,t.find(function(t){return t.id===e.id})).getResourceObject().data:e}),this},lt.prototype.removeDuplicatedRelationships=function(){if(!this.resource_object.data.relationships||!this.parent_resource_object.data.relationships)return this;for(var t in this.resource_object.data.relationships)r.isEqual(this.resource_object.data.relationships[t],this.parent_resource_object.data.relationships[t])&&delete this.resource_object.data.relationships[t];return this},lt.prototype.removeDuplicatedAttributes=function(){if(!this.resource_object.data.attributes||!this.parent_resource_object.data.attributes)return this;for(var t in this.resource_object.data.attributes)this.resource_object.data.attributes[t]===this.parent_resource_object.data.attributes[t]&&delete this.resource_object.data.attributes[t];return this},lt);function lt(t,e,i){this.parent_resource_object=e instanceof R?e.toObject(i):{data:e},!function(t){return t&&t.toObject&&"function"==typeof t.toObject&&t.superToObject&&"function"==typeof t.superToObject}(t)?this.resource_object={data:t}:this.resource_object=t.superToObject(i),this.removeDuplicatedAttributes(),this.removeDuplicatedRelationships(),this.removeDuplicatedIncludes()}var ht,pt=(l(ft,ht=R),ft.prototype.toObject=function(t){return new dt(this,this.parent,t).getResourceObject()},ft.prototype.superToObject=function(t){return ht.prototype.toObject.call(this,t)},ft.prototype.copySourceFromParent=function(){for(var t in this.source=this.parent.source,this.relationships)this.relationships[t].source=this.parent.relationships[t].source},ft);function ft(t){var e=ht.call(this)||this;e.parent=r.cloneDeep(t),e.type=e.parent.type,delete e.relationships;var i=Object.keys(e.parent.relationships);return e.fill(e.parent.toObject({include:i})),e.copySourceFromParent(),e}var vt=function(o,s,a,c){return new(a||(a=Promise))(function(t,e){function i(t){try{n(c.next(t))}catch(t){e(t)}}function r(t){try{n(c.throw(t))}catch(t){e(t)}}function n(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(i,r)}n((c=c.apply(o,s||[])).next())})},gt=(yt.prototype.register=function(){if(null===et.me)throw new Error("Error: you are trying register `"+this.type+"` before inject JsonapiCore somewhere, almost one time.");return et.me.registerService(this)},yt.prototype.newResource=function(){return this.new()},yt.prototype.newCollection=function(){return new E},yt.prototype.new=function(){var t=new this.resource;return t.type=this.type,this.getService(),t.reset(),t},yt.prototype.getPrePath=function(){return""},yt.prototype.getPath=function(){return this.path||this.type},yt.prototype.getClone=function(t,e){return void 0===e&&(e={}),this.get(t,e).pipe(c.map(function(t){return new pt(t)}))},yt.prototype.pathForGet=function(t,e){void 0===e&&(e={}),e=Object.assign({},A.ParamsResource,e);var i=new g;return i.applyParams(this,e),i.appendPath(t),i.get()},yt.prototype.get=function(t,e){var i=this;void 0===e&&(e={}),e=Object.assign({},A.ParamsResource,e);var r=new g;r.applyParams(this,e),r.appendPath(t);var n=this.getOrCreateResource(t);n.setLoaded(!1);var o=new a.BehaviorSubject(n);return 0<Object.keys(e.fields||[]).length?this.getGetFromServer(r,n,o):z(n,e.ttl)&&function(t,e){if(0===e.length)return!0;for(var i in t.relationships)if(e.includes(i)&&!t.relationships[i].builded)return!1;return!0}(n,e.include||[])?(n.setLoaded(!0),setTimeout(function(){return o.complete()},0)):0===n.cache_last_update?this.getGetFromLocal(e,r,n).then(function(){o.next(n),setTimeout(function(){return o.complete()},0)}).catch(function(){n.setLoaded(!1),i.getGetFromServer(r,n,o)}):this.getGetFromServer(r,n,o),o.asObservable()},yt.prototype.getGetFromLocal=function(i,r,n){return void 0===i&&(i={}),vt(this,void 0,void 0,function(){var e;return h(this,function(t){switch(t.label){case 0:if(!et.injectedServices.rsJsonapiConfig.cachestore_support)throw new Error("We cant handle this request");return n.setLoaded(!1),[4,(new B).getResource(B.getResourceKey(n),r.includes)];case 1:if(e=t.sent(),n.fill(e),n.setSource("store"),z(n,i.ttl))return n.setLoadedAndPropagate(!0),[2];throw new Error("Resource is dead!")}})})},yt.prototype.getGetFromServer=function(e,i,r){et.get(e.get()).subscribe(function(t){i.fill(t),i.cache_last_update=Date.now(),i.setLoadedAndPropagate(!0),i.setSourceAndPropagate("server"),et.injectedServices.rsJsonapiConfig.cachestore_support&&(new B).saveResource(i,e.includes),r.next(i),setTimeout(function(){return r.complete()},0)},function(t){i.setLoadedAndPropagate(!0),r.next(i),r.error(t)})},yt.prototype.getService=function(){return b.getService(this.type)||this.register()},yt.prototype.getOrCreateCollection=function(t){var e=this.getService(),i=I.getInstance().getOrCreateCollection(t.getForCache());return i.ttl=e.collections_ttl,"new"!==i.source&&(i.source="memory"),i},yt.prototype.getOrCreateResource=function(t){var e,i=this.getService();return null===(e=I.getInstance().getResource(this.type,t))&&((e=i.new()).id=t,I.getInstance().setResource(e,!1)),"new"!==e.source&&(e.source="memory"),e},yt.prototype.createResource=function(t){var e=b.getServiceOrFail(this.type).new();return e.id=t,I.getInstance().setResource(e,!1),e},yt.prototype.clearCacheMemory=function(){return vt(this,void 0,void 0,function(){return h(this,function(t){return[2,this.clearCache()]})})},yt.prototype.clearCache=function(){return vt(this,void 0,void 0,function(){var e;return h(this,function(t){return(e=new g).applyParams(this),I.getInstance().deprecateCollections(e.getForCache()),[2,(new B).deprecateCollection(e.getForCache()).then(function(){return!0})]})})},yt.prototype.parseToServer=function(t){},yt.prototype.parseFromServer=function(t){},yt.prototype.delete=function(e,t){var i=this;t=Object.assign({},A.ParamsResource,t);var r=new g;r.applyParams(this,t),r.appendPath(e);var n=new a.Subject;return et.delete(r.get()).subscribe(function(t){I.getInstance().removeResource(i.type,e),n.next(),n.complete()},function(t){n.error(t)}),n.asObservable()},yt.prototype.pathForAll=function(t){void 0===t&&(t={});var e=Object.assign({},A.ParamsCollection,t),i=new ct;return i.applyParams(this,e),i.get()},yt.prototype.all=function(t){var e=this;void 0===t&&(t={});var i=Object.assign({},A.ParamsCollection,t);i.ttl||0===i.ttl||(i.ttl=this.collections_ttl);var r=new ct;r.applyParams(this,i);var n=this.getOrCreateCollection(r);n.page.number=1*i.page.number;var o=new a.BehaviorSubject(n);return 0<Object.keys(i.fields).length?this.getAllFromServer(r,i,n,o):z(n,i.ttl)?setTimeout(function(){return o.complete()},0):0===n.cache_last_update?(n.source="new",this.getAllFromLocal(i,r,n).then(function(){o.next(n),setTimeout(function(){o.complete()},0)}).catch(function(){n.setLoaded(!1),e.getAllFromServer(r,i,n,o)})):this.getAllFromServer(r,i,n,o),o.asObservable()},yt.prototype.getAllFromLocal=function(i,r,n){return void 0===i&&(i={}),vt(this,void 0,void 0,function(){var e;return h(this,function(t){switch(t.label){case 0:if(!et.injectedServices.rsJsonapiConfig.cachestore_support)throw new Error("We cant handle this request");return n.setLoaded(!1),"compact"!==i.store_cache_method?[3,2]:[4,et.injectedServices.JsonapiStoreService.getDataObject("collection",r.getForCache()+".compact")];case 1:return e=t.sent(),[3,4];case 2:return[4,(new B).getCollection(r.getForCache(),r.includes)];case 3:e=t.sent(),t.label=4;case 4:if(n.fill(e),n.setSourceAndPropagate("store"),z(n,i.ttl))return n.setLoadedAndPropagate(!0),n.setBuildedAndPropagate(!0),[2];throw new Error("Collection is dead!")}})})},yt.prototype.getAllFromServer=function(r,n,o,s){o.setLoaded(!1),et.get(r.get()).subscribe(function(t){if(n.cachehash)for(var e in t.data){var i=t.data[e];i.id=i.id+n.cachehash}o.fill(t),o.cache_last_update=Date.now(),o.setCacheLastUpdateAndPropagate(),o.setSourceAndPropagate("server"),o.setLoadedAndPropagate(!0),et.injectedServices.rsJsonapiConfig.cachestore_support&&(new B).saveCollection(r.getForCache(),o,r.includes),et.injectedServices.rsJsonapiConfig.cachestore_support&&"compact"===n.store_cache_method&&et.injectedServices.JsonapiStoreService.saveCollection(r.getForCache()+".compact",t),s.next(o),setTimeout(function(){return s.complete()},0)},function(t){o.setLoadedAndPropagate(!0),s.next(o),s.error(t)})},yt);function yt(){var t=this;this.resource=R,setTimeout(function(){return t.register()})}var bt,mt=(l(_t,bt=R),_t);function _t(){var t=bt.call(this)||this;return t.attributes={name:"",date_of_birth:new Date,date_of_death:new Date,created_at:new Date,updated_at:new Date},t.relationships={books:new E,photos:new E},t.type="authors",t.ttl=0,!_t.test_ttl&&0!==_t.test_ttl||(t.ttl=_t.test_ttl),t}var wt,Rt=(l(jt,wt=gt),jt);function jt(){var t=wt.call(this)||this;return t.resource=mt,t.type="authors",t.collections_ttl=0,t.register(),t}var St,Ot=(l(Ct,St=R),Ct);function Ct(){var t=St.call(this)||this;return t.attributes={date_published:new Date,title:"",created_at:new Date,updated_at:new Date},t.relationships={author:new T,photos:new E},t.type="books",t.ttl=0,!Ct.test_ttl&&0!==Ct.test_ttl||(t.ttl=Ct.test_ttl),t}var Pt,Dt=(l(Et,Pt=gt),Et);function Et(){var t=Pt.call(this)||this;return t.type="books",t.resource=Ot,t.collections_ttl=0,t.register(),t}var xt,At=(l(Ft,xt=R),Ft);function Ft(){var t=xt.call(this)||this;return t.attributes={title:"",uri:"",imageable_id:"",created_at:new Date,updated_at:new Date},t.type="photos",t.ttl=0,!Ft.test_ttl&&0!==Ft.test_ttl||(t.ttl=Ft.test_ttl),t}var It,kt=(l(Lt,It=gt),Lt);function Lt(){var t=It.call(this)||this;return t.resource=At,t.type="photos",t.register(),t}var Tt=(Jt.getResourceDocumentData=function(t,e,i){void 0===e&&(e=[]);var r=this["get"+t.name](i,e).toObject();return Jt.fillDocumentDataIncludedRelatioships(r,e),r},Jt.getCollectionDocumentData=function(t,e,i){void 0===e&&(e=2),void 0===i&&(i=[]);var r=this.getCollection(t,e,i).toObject();return Jt.fillDocumentDataIncludedRelatioships(r,i),r},Jt.getBookDocumentData=function(){},Jt.getPhotoDocumentData=function(){},Jt.getBook=function(t,e,i){void 0===e&&(e=[]),void 0===i&&(i=0);var r=new Ot;return r.id=this.getId(t),r.ttl=i,Jt.fillBookAttributes(r),r.relationships.author.data=this.getDataResourceWithType("authors"),e.includes("author")&&this.includeFromService(r,"author",mt),r.relationships.photos.data=r.relationships.photos.data.concat(this.getDataResourcesWithType("photos",2)),e.includes("photos")&&this.includeFromService(r,"photos",At),r},Jt.getAuthor=function(t,e,i){void 0===e&&(e=[]),void 0===i&&(i=0);var r=new mt;if(r.id=this.getId(t),r.ttl=i,Jt.fillAuthorAttributes(r),r.relationships.books.data=r.relationships.books.data.concat(this.getDataResourcesWithType("books",2)),e.includes("books")){this.includeFromService(r,"books",Ot);for(var n=0,o=r.relationships.books.data;n<o.length;n++)o[n].relationships.author.data.id=r.id}return r.relationships.photos.data=r.relationships.photos.data.concat(this.getDataResourcesWithType("photos",2)),e.includes("photos")&&this.includeFromService(r,"photos",At),r},Jt.getPhoto=function(t,e,i){void 0===e&&(e=[]),void 0===i&&(i=0);var r=new At;return r.id=this.getId(t),r.ttl=i,Jt.fillPhotoAttirbutes(r),r},Jt.getCollection=function(t,e,i){void 0===e&&(e=2),void 0===i&&(i=[]);for(var r=new E,n=0;n<e;n++){var o=this["get"+t.name](void 0,i);r.data.push(o)}return r.setBuilded(!0),r.setLoaded(!0),r.cache_last_update=Date.now(),r},Jt.fillAuthorAttributes=function(t){return t},Jt.fillBookAttributes=function(t){return t},Jt.fillPhotoAttirbutes=function(t){return t},Jt.getId=function(t){return t||"new_"+Math.floor(1e4*Math.random()).toString()},Jt.includeFromService=function(t,e,i){var r=t.relationships[e];r?r.data&&"id"in r.data?this.includeHasOneFromService(t,e,i):r instanceof E&&this.includeHasManyFromService(t,e,i):console.error(e+" relationship doesn't exist in "+t.type)},Jt.includeHasOneFromService=function(t,e,i){var r=new i,n=t.relationships[e];n&&n.data&&(r.id=n.data.id,Jt["fill"+i.name+"Attributes"](r),t.addRelationship(r,e))},Jt.includeHasManyFromService=function(t,e,i){for(var r=[],n=0,o=t.relationships[e].data;n<o.length;n++){var s=o[n],a=new i;a.id=s.id,Jt["fill"+i.name+"Attributes"](a),r.push(a)}t.relationships[e].data=r},Jt.getDataResourceWithType=function(t,e){return{id:this.getId(e),type:t}},Jt.getDataResourcesWithType=function(t,e){for(var i=[],r=0;r<e;r++)i.push(this.getDataResourceWithType(t));return i},Jt.fillResourceRelationshipsInDocumentData=function(t,e,i){t.included||(t.included=[]);var r=e.relationships[i];if(r instanceof T||"type"in r.data){var n=r.data;if(!n)return void console.warn("relationship content is empty");var o=Jt.resource_classes_by_type[n.type];if(!o)return void console.warn("cannot find the required class for type "+n.type);t.included.push(this["get"+o.name](n.id))}else if(r instanceof E||r.data instanceof Array)for(var s=0,a=e.relationships[i].data;s<a.length;s++){var c=a[s];t.included.push(this["get"+Jt.resource_classes_by_type[c.type].name](c.id))}},Jt.fillDocumentDataIncludedRelatioships=function(t,e){for(var i=0,r=e;i<r.length;i++){var n=r[i];if(t.included||(t.included=[]),t.data.id){if(!t.data.relationships[n].data)continue;return void Jt.fillResourceRelationshipsInDocumentData(t,t.data,n)}for(var o=0,s=t.data;o<s.length;o++){var a=s[o];Jt.fillResourceRelationshipsInDocumentData(t,a,n)}}},Jt);function Jt(){}Tt.resource_classes_by_type={photos:At,books:Ot,authors:mt},t.Autoregister=function(){return function(t){}},t.JsonapiCore=et,t.Resource=R,t.DocumentResource=T,t.DocumentCollection=E,t.Service=gt,t.Author=mt,t.AuthorsService=Rt,t.Book=Ot,t.BooksService=Dt,t.Photo=At,t.PhotosService=kt,t.TestFactory=Tt,t.NgxJsonapiModule=rt,t.ɵe=S,t.ɵa=C,t.ɵb=U,t.ɵd=N,t.ɵc=X,Object.defineProperty(t,"__esModule",{value:!0})});