{"version":3,"file":"document-collection.js","sourceRoot":"","sources":["../src/document-collection.ts"],"names":[],"mappings":"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","sourcesContent":["import { Resource } from './resource';\nimport { Page } from './services/page';\nimport { Document } from './document';\nimport { ICacheable } from './interfaces/cacheable';\nimport { IResourcesByType } from './interfaces/resources-by-type';\nimport { Converter } from './services/converter';\nimport { IDataCollection } from './interfaces/data-collection';\n\nexport class DocumentCollection<R extends Resource = Resource> extends Document implements ICacheable {\n    public data: Array<R> = [];\n    public page = new Page();\n    public data_collection: IDataCollection;\n\n    public trackBy(iterated_resource: Resource): string {\n        return iterated_resource.id;\n    }\n\n    public find(id: string): R {\n        // this is the best way: https://jsperf.com/fast-array-foreach\n        for (let i = 0; i < this.data.length; i++) {\n            if (this.data[i].id === id) {\n                return this.data[i];\n            }\n        }\n\n        return null;\n    }\n\n    public fill(data_collection: IDataCollection, included_resources?: IResourcesByType): void {\n        \n        this.data_collection = data_collection;\n        included_resources = included_resources || Converter.buildIncluded(data_collection);\n\n        // sometimes get Cannot set property 'number' of undefined (page)\n        if (this.page && data_collection.meta) {\n            this.page.number = data_collection.meta.page || 1;\n            this.page.resources_per_page = data_collection.meta.resources_per_page || null; // @deprecated (v2.0.2)\n            this.page.size = data_collection.meta.resources_per_page || null;\n            this.page.total_resources = data_collection.meta.total_resources || null;\n        }\n\n        // convert and add new dataresoures to final collection\n        let new_ids = {};\n        this.data = [];\n        this.builded = data_collection.data && data_collection.data.length === 0;\n        for (let dataresource of data_collection.data) {\n            let res = this.find(dataresource.id) || Converter.getService(dataresource.type).getOrCreateResource(dataresource.id);\n            res.fill({ data: dataresource } , included_resources ); // @todo check with included resources?\n            new_ids[dataresource.id] = dataresource.id;\n            this.data.push(<R>res);\n            if (Object.keys(res.attributes).length > 0) {\n                this.builded = true;\n            }\n        }\n\n        // remove old members of collection (bug, for example, when request something like orders/10/details and has new ids)\n        // @todo test with relation.data.filter(resource =>  resource.id != id );\n        for (let i; i < this.data.length; i++) {\n            if (!(this.data[i].id in new_ids)) {\n                delete this.data[i];\n            }\n        }\n\n        this.meta = data_collection.meta || {};\n    }\n\n    public replaceOrAdd(resource: R): void {\n        let res = this.find(resource.id);\n        if (res === null) {\n            this.data.push(resource);\n        } else {\n            res = resource;\n        }\n    }\n\n    public hasMorePages(): boolean | null {\n        if (this.page.size < 1) {\n            return null;\n        }\n\n        let total_resources = this.page.size * (this.page.number - 1) + this.data.length;\n\n        return total_resources < this.page.total_resources;\n    }\n}\n"]}